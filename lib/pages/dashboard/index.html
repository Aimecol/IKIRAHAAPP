<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ikiraha Dashboard</title>

    <!-- Preconnect for performance -->
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">

    <!-- Local Icons -->
    <link rel="stylesheet" href="css/icons.css">

    <!-- Stylesheets -->
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/pages.css">
    <link rel="stylesheet" href="css/responsive.css">

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="favicon.ico">

    <!-- Prefers reduced motion -->
    <style>
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body class="dashboard-body">
    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen">
        <div class="loading-spinner"></div>
        <p>Loading Dashboard...</p>
    </div>

    <!-- Main App Container -->
    <div id="app" class="app-container" style="display: none;">
        <!-- Navigation will be injected here -->
        <nav id="navigation-container"></nav>

        <!-- Main Content Area -->
        <main id="main-content" class="main-content">
            <!-- Top Bar -->
            <header id="top-bar" class="top-bar">
                <div class="top-bar-left">
                    <button id="nav-toggle" class="nav-toggle" aria-label="Toggle navigation">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div id="breadcrumbs" class="breadcrumbs">
                        <span class="breadcrumb-item">Dashboard</span>
                    </div>
                </div>

                <div class="top-bar-center">
                    <div class="search-container">
                        <i class="fas fa-search search-icon"></i>
                        <input type="search" id="global-search" placeholder="Search..." class="search-input">
                    </div>
                </div>

                <div class="top-bar-right">
                    <button id="notifications-btn" class="icon-button" aria-label="Notifications">
                        <i class="fas fa-bell"></i>
                        <span id="notification-badge" class="notification-badge">3</span>
                    </button>

                    <div class="profile-dropdown">
                        <button id="profile-btn" class="profile-button" aria-label="Profile menu">
                            <div class="profile-avatar">
                                <span class="avatar-initials">U</span>
                            </div>
                            <span class="profile-name">John Doe</span>
                            <i class="fas fa-chevron-down profile-chevron"></i>
                        </button>
                        <div id="profile-menu" class="profile-menu">
                            <a href="#" class="profile-menu-item">
                                <i class="fas fa-user"></i>
                                Profile
                            </a>
                            <a href="#" class="profile-menu-item">
                                <i class="fas fa-cog"></i>
                                Settings
                            </a>
                            <hr class="profile-menu-divider">
                            <a href="#" class="profile-menu-item">
                                <i class="fas fa-sign-out-alt"></i>
                                Sign Out
                            </a>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Page Content -->
            <div id="page-content" class="page-content">
                <!-- Content will be dynamically loaded here -->
            </div>
        </main>

        <!-- Mobile Bottom Navigation -->
        <nav id="mobile-nav" class="mobile-nav">
            <!-- Mobile nav will be injected here -->
        </nav>
    </div>

    <!-- Notification Toast Container -->
    <div id="toast-container" class="toast-container"></div>

    <!-- Modal Container -->
    <div id="modal-container" class="modal-container"></div>

    <!-- Inline Scripts for File Protocol Compatibility -->
    <script>
        // All JavaScript components inlined to work with file:// protocol

        // Toast Manager
        class ToastManager {
          constructor() {
            this.toasts = [];
            this.container = null;
            this.init();
          }

          init() {
            this.container = document.getElementById('toast-container');
            if (!this.container) {
              this.container = document.createElement('div');
              this.container.id = 'toast-container';
              this.container.className = 'toast-container';
              document.body.appendChild(this.container);
            }
          }

          show(message, type = 'info', duration = 5000) {
            const toast = this.createToast(message, type);
            this.toasts.push(toast);
            this.container.appendChild(toast.element);

            setTimeout(() => {
              toast.element.classList.add('show');
            }, 10);

            if (duration > 0) {
              setTimeout(() => {
                this.hide(toast);
              }, duration);
            }

            return toast;
          }

          createToast(message, type) {
            const toastElement = document.createElement('div');
            toastElement.className = `toast toast-${type}`;

            toastElement.innerHTML = `
              <div class="toast-content">
                <i class="toast-icon fas ${this.getIcon(type)}"></i>
                <span class="toast-message">${message}</span>
                <button class="toast-close" aria-label="Close">
                  <i class="fas fa-times"></i>
                </button>
              </div>
            `;

            const toast = {
              element: toastElement,
              hide: () => this.hide(toast)
            };

            toastElement.querySelector('.toast-close').addEventListener('click', () => toast.hide());
            return toast;
          }

          getIcon(type) {
            const icons = {
              success: 'fa-check-circle',
              error: 'fa-exclamation-circle',
              warning: 'fa-exclamation-triangle',
              info: 'fa-info-circle'
            };
            return icons[type] || icons.info;
          }

          hide(toast) {
            toast.element.classList.remove('show');
            setTimeout(() => {
              if (toast.element.parentNode) {
                toast.element.parentNode.removeChild(toast.element);
              }
              this.toasts = this.toasts.filter(t => t !== toast);
            }, 300);
          }

          success(message, duration) { return this.show(message, 'success', duration); }
          error(message, duration) { return this.show(message, 'error', duration); }
          warning(message, duration) { return this.show(message, 'warning', duration); }
          info(message, duration) { return this.show(message, 'info', duration); }
        }

        // AuthManager
        class AuthManager {
          constructor() {
            this.currentUser = null;
            this.currentRole = null;
            this.isAuthenticated = false;
            this.mockUsers = [
              {
                id: 1,
                email: 'admin@ikiraha.com',
                password: 'admin123',
                name: 'Super Admin',
                role: 'super_admin',
                permissions: ['all']
              },
              {
                id: 2,
                email: 'merchant@ikiraha.com',
                password: 'merchant123',
                name: 'Restaurant Owner',
                role: 'merchant',
                permissions: ['products', 'orders', 'analytics', 'profile']
              },
              {
                id: 3,
                email: 'accountant@ikiraha.com',
                password: 'accountant123',
                name: 'Financial Manager',
                role: 'accountant',
                permissions: ['transactions', 'reports', 'analytics', 'profile']
              }
            ];
          }

          async checkAuth() {
            const storedUser = localStorage.getItem('dashboard-user');
            const storedRole = localStorage.getItem('dashboard-role');

            if (storedUser && storedRole) {
              try {
                this.currentUser = JSON.parse(storedUser);
                this.currentRole = storedRole;
                this.isAuthenticated = true;
                return true;
              } catch (error) {
                this.clearAuth();
                return false;
              }
            }
            return false;
          }

          getCurrentUser() { return this.currentUser; }
          getCurrentRole() { return this.currentRole; }
          isLoggedIn() { return this.isAuthenticated; }

          clearAuth() {
            this.currentUser = null;
            this.currentRole = null;
            this.isAuthenticated = false;
            localStorage.removeItem('dashboard-user');
            localStorage.removeItem('dashboard-role');
          }
        }

        // DataService
        class DataService {
          constructor() {
            this.cache = new Map();
            this.cacheTimeout = 5 * 60 * 1000; // 5 minutes
          }

          async getDashboardData(role = 'merchant') {
            const cacheKey = `dashboard-${role}`;
            const cached = this.getFromCache(cacheKey);
            if (cached) return cached;

            const data = this.getMockData('dashboard');
            this.setCache(cacheKey, data);
            return data;
          }

          getMockData(endpoint) {
            const mockData = {
              dashboard: {
                kpis: {
                  super_admin: [
                    { id: "total_orders", title: "Total Orders", value: "1,234", change: "+12%", changeType: "positive", icon: "fas fa-shopping-cart" },
                    { id: "revenue", title: "Revenue", value: "$45,678", change: "+8%", changeType: "positive", icon: "fas fa-dollar-sign" },
                    { id: "active_merchants", title: "Active Merchants", value: "567", change: "-2%", changeType: "negative", icon: "fas fa-store" },
                    { id: "pending_tasks", title: "Pending Tasks", value: "23", change: "0%", changeType: "neutral", icon: "fas fa-clock" }
                  ],
                  merchant: [
                    { id: "orders", title: "Orders", value: "89", change: "+15%", changeType: "positive", icon: "fas fa-shopping-cart" },
                    { id: "revenue", title: "Revenue", value: "$3,456", change: "+22%", changeType: "positive", icon: "fas fa-dollar-sign" },
                    { id: "products", title: "Products", value: "45", change: "+3", changeType: "positive", icon: "fas fa-box" },
                    { id: "rating", title: "Rating", value: "4.8", change: "+0.2", changeType: "positive", icon: "fas fa-star" }
                  ],
                  accountant: [
                    { id: "transactions", title: "Transactions", value: "2,345", change: "+18%", changeType: "positive", icon: "fas fa-credit-card" },
                    { id: "total_revenue", title: "Total Revenue", value: "$78,901", change: "+12%", changeType: "positive", icon: "fas fa-chart-line" },
                    { id: "pending_payments", title: "Pending Payments", value: "$5,432", change: "-8%", changeType: "negative", icon: "fas fa-clock" },
                    { id: "monthly_profit", title: "Monthly Profit", value: "$12,345", change: "+25%", changeType: "positive", icon: "fas fa-piggy-bank" }
                  ]
                },
                recentActivity: [
                  { id: 1, title: "New order received", description: "Order #1234 from John Doe", timestamp: new Date().toISOString(), icon: "fas fa-plus" },
                  { id: 2, title: "New user registered", description: "Jane Smith joined as merchant", timestamp: new Date(Date.now() - 900000).toISOString(), icon: "fas fa-user" },
                  { id: 3, title: "Order completed", description: "Order #1230 delivered successfully", timestamp: new Date(Date.now() - 1800000).toISOString(), icon: "fas fa-check" },
                  { id: 4, title: "Payment processed", description: "$234.50 payment confirmed", timestamp: new Date(Date.now() - 2700000).toISOString(), icon: "fas fa-credit-card" },
                  { id: 5, title: "Product updated", description: "Burger Special price changed", timestamp: new Date(Date.now() - 3600000).toISOString(), icon: "fas fa-edit" }
                ],
                quickActions: {
                  super_admin: [
                    { id: "add_merchant", title: "Add Merchant", description: "Register new restaurant", icon: "fas fa-plus", action: "addMerchant", color: "primary" },
                    { id: "view_reports", title: "View Reports", description: "System analytics", icon: "fas fa-chart-bar", action: "viewReports", color: "secondary" },
                    { id: "manage_users", title: "Manage Users", description: "User administration", icon: "fas fa-users", action: "manageUsers", color: "secondary" }
                  ],
                  merchant: [
                    { id: "add_product", title: "Add Product", description: "Create new menu item", icon: "fas fa-plus", action: "addProduct", color: "primary" },
                    { id: "view_orders", title: "View Orders", description: "Check pending orders", icon: "fas fa-list", action: "viewOrders", color: "secondary" },
                    { id: "view_analytics", title: "View Analytics", description: "Business insights", icon: "fas fa-chart-line", action: "viewAnalytics", color: "secondary" }
                  ],
                  accountant: [
                    { id: "export_transactions", title: "Export Data", description: "Download CSV report", icon: "fas fa-download", action: "exportTransactions", color: "primary" },
                    { id: "view_reports", title: "Financial Reports", description: "Monthly summaries", icon: "fas fa-file-alt", action: "viewReports", color: "secondary" },
                    { id: "reconcile_accounts", title: "Reconcile", description: "Account reconciliation", icon: "fas fa-balance-scale", action: "reconcileAccounts", color: "secondary" }
                  ]
                }
              }
            };
            return mockData[endpoint] || {};
          }

          getFromCache(key) {
            const cached = this.cache.get(key);
            if (cached && Date.now() - cached.timestamp < this.cacheTimeout) {
              return cached.data;
            }
            return null;
          }

          setCache(key, data) {
            this.cache.set(key, {
              data,
              timestamp: Date.now()
            });
          }
        }

        // Router
        class Router {
          constructor() {
            this.routes = {};
            this.currentRoute = null;
            this.init();
          }

          init() {
            window.addEventListener('hashchange', () => this.handleRouteChange());
            window.addEventListener('load', () => this.handleRouteChange());
          }

          addRoute(path, handler) {
            this.routes[path] = handler;
          }

          navigate(path) {
            window.location.hash = path;
          }

          async handleRouteChange() {
            const hash = window.location.hash.slice(1) || 'dashboard';
            const route = hash.split('/')[0];

            if (this.routes[route]) {
              this.currentRoute = route;
              try {
                await this.routes[route]();
                this.updateBreadcrumbs(route);
              } catch (error) {
                console.error('Route error:', error);
                this.handleError(error.message);
              }
            } else {
              this.handle404();
            }
          }

          updateBreadcrumbs(route) {
            const breadcrumbs = document.getElementById('breadcrumbs');
            if (breadcrumbs) {
              const routeNames = {
                dashboard: 'Dashboard',
                users: 'Users',
                merchants: 'Merchants',
                products: 'Products',
                orders: 'Orders',
                transactions: 'Transactions',
                analytics: 'Analytics',
                settings: 'Settings',
                profile: 'Profile',
                notifications: 'Notifications'
              };
              breadcrumbs.innerHTML = `<span class="breadcrumb-item">${routeNames[route] || route}</span>`;
            }
          }

          handleError(message) {
            const content = document.getElementById('page-content');
            if (content) {
              content.innerHTML = `
                <div class="error-page">
                  <div class="error-content">
                    <h2>Error</h2>
                    <p>${message}</p>
                    <button class="btn btn-primary" onclick="window.location.reload()">
                      <i class="fas fa-refresh"></i>
                      Reload Page
                    </button>
                  </div>
                </div>
              `;
            }
          }

          handle404() {
            const content = document.getElementById('page-content');
            if (content) {
              content.innerHTML = `
                <div class="error-page">
                  <div class="error-content">
                    <h2>Page Not Found</h2>
                    <p>The page you're looking for doesn't exist.</p>
                    <button class="btn btn-primary" onclick="window.location.hash = 'dashboard'">
                      <i class="fas fa-home"></i>
                      Go to Dashboard
                    </button>
                  </div>
                </div>
              `;
            }
          }
        }

        // Enhanced Navigation Component
        class NavigationComponent {
          constructor() {
            this.currentRole = localStorage.getItem('dashboard-role') || 'merchant';
            this.isCollapsed = localStorage.getItem('sidebar-collapsed') === 'true';
            this.isMobile = window.innerWidth <= 768;
            this.mobileMenuOpen = false;
          }

          getNavigationItems() {
            const baseItems = [
              { id: 'dashboard', label: 'Dashboard', icon: 'fas fa-tachometer-alt', href: '#dashboard' },
              { id: 'products', label: 'Products', icon: 'fas fa-box', href: '#products' },
              { id: 'orders', label: 'Orders', icon: 'fas fa-shopping-cart', href: '#orders' },
              { id: 'analytics', label: 'Analytics', icon: 'fas fa-chart-bar', href: '#analytics' },
              { id: 'settings', label: 'Settings', icon: 'fas fa-cog', href: '#settings' },
              { id: 'profile', label: 'Profile', icon: 'fas fa-user', href: '#profile' },
              { id: 'notifications', label: 'Notifications', icon: 'fas fa-bell', href: '#notifications' }
            ];

            if (this.currentRole === 'super_admin') {
              baseItems.splice(1, 0,
                { id: 'users', label: 'Users', icon: 'fas fa-users', href: '#users' },
                { id: 'merchants', label: 'Merchants', icon: 'fas fa-store', href: '#merchants' }
              );
            }

            if (this.currentRole === 'accountant') {
              baseItems.splice(3, 0,
                { id: 'transactions', label: 'Transactions', icon: 'fas fa-credit-card', href: '#transactions' }
              );
            }

            return baseItems;
          }

          render() {
            this.renderDesktopNavigation();
            this.renderMobileNavigation();
            this.setupEventListeners();
            this.updateActiveRoute();
            this.handleResize();
          }

          renderDesktopNavigation() {
            const navItems = this.getNavigationItems();
            const navHTML = `
              <aside class="sidebar ${this.isCollapsed ? 'collapsed' : ''}">
                <div class="sidebar-header">
                  <div class="sidebar-logo">I</div>
                  <div class="sidebar-title">Ikiraha</div>
                  <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <i class="fas fa-chevron-left"></i>
                  </button>
                </div>
                <nav class="sidebar-nav">
                  ${navItems.map(item => `
                    <div class="nav-item">
                      <a href="${item.href}" class="nav-link" data-route="${item.id}">
                        <div class="nav-icon">
                          <i class="${item.icon}"></i>
                        </div>
                        <span class="nav-text">${item.label}</span>
                      </a>
                    </div>
                  `).join('')}
                </nav>
              </aside>
            `;

            const container = document.getElementById('navigation-container');
            if (container) container.innerHTML = navHTML;
          }

          renderMobileNavigation() {
            const navItems = this.getNavigationItems().slice(0, 5); // Show only main items on mobile
            const navHTML = `
              <div class="mobile-nav-container">
                ${navItems.map(item => `
                  <a href="${item.href}" class="mobile-nav-item" data-route="${item.id}">
                    <div class="mobile-nav-icon">
                      <i class="${item.icon}"></i>
                    </div>
                    <span>${item.label}</span>
                  </a>
                `).join('')}
              </div>
            `;

            const container = document.getElementById('mobile-nav');
            if (container) container.innerHTML = navHTML;
          }

          setupEventListeners() {
            // Desktop sidebar toggle
            const sidebarToggle = document.getElementById('sidebar-toggle');
            if (sidebarToggle) {
              sidebarToggle.addEventListener('click', (e) => {
                e.preventDefault();
                this.toggleSidebar();
              });
            }

            // Mobile hamburger menu toggle
            const navToggle = document.getElementById('nav-toggle');
            if (navToggle) {
              navToggle.addEventListener('click', (e) => {
                e.preventDefault();
                this.toggleMobileMenu();
              });
            }

            // Navigation links
            this.setupNavigationLinks();

            // Handle resize
            window.addEventListener('resize', () => this.handleResize());

            // Close mobile menu when clicking outside
            document.addEventListener('click', (e) => {
              if (this.isMobile && this.mobileMenuOpen && !e.target.closest('.sidebar') && !e.target.closest('.nav-toggle')) {
                this.closeMobileMenu();
              }
            });
          }

          setupNavigationLinks() {
            // Desktop navigation links
            document.querySelectorAll('.nav-link[data-route]').forEach(link => {
              link.addEventListener('click', (e) => {
                e.preventDefault();
                const route = e.currentTarget.getAttribute('data-route');
                this.navigateToRoute(route);
                if (this.isMobile) {
                  this.closeMobileMenu();
                }
              });
            });

            // Mobile navigation links
            document.querySelectorAll('.mobile-nav-item[data-route]').forEach(link => {
              link.addEventListener('click', (e) => {
                e.preventDefault();
                const route = e.currentTarget.getAttribute('data-route');
                this.navigateToRoute(route);
              });
            });
          }

          toggleSidebar() {
            if (this.isMobile) {
              this.toggleMobileMenu();
            } else {
              this.isCollapsed = !this.isCollapsed;
              localStorage.setItem('sidebar-collapsed', this.isCollapsed.toString());

              const sidebar = document.querySelector('.sidebar');
              const mainContent = document.querySelector('.main-content');
              const toggleIcon = document.querySelector('#sidebar-toggle i');

              if (sidebar) {
                sidebar.classList.toggle('collapsed', this.isCollapsed);
              }

              if (mainContent) {
                mainContent.style.marginLeft = this.isCollapsed ? '80px' : '280px';
                mainContent.classList.toggle('sidebar-collapsed', this.isCollapsed);
              }

              if (toggleIcon) {
                toggleIcon.className = this.isCollapsed ? 'fas fa-chevron-right' : 'fas fa-chevron-left';
              }
            }
          }

          toggleMobileMenu() {
            this.mobileMenuOpen = !this.mobileMenuOpen;
            const sidebar = document.querySelector('.sidebar');
            const overlay = document.querySelector('.mobile-overlay') || this.createMobileOverlay();

            if (sidebar) {
              sidebar.classList.toggle('mobile-open', this.mobileMenuOpen);
            }

            if (this.mobileMenuOpen) {
              document.body.appendChild(overlay);
              document.body.style.overflow = 'hidden';
            } else {
              if (overlay.parentNode) {
                overlay.parentNode.removeChild(overlay);
              }
              document.body.style.overflow = '';
            }
          }

          closeMobileMenu() {
            this.mobileMenuOpen = false;
            const sidebar = document.querySelector('.sidebar');
            const overlay = document.querySelector('.mobile-overlay');

            if (sidebar) {
              sidebar.classList.remove('mobile-open');
            }

            if (overlay && overlay.parentNode) {
              overlay.parentNode.removeChild(overlay);
            }

            document.body.style.overflow = '';
          }

          createMobileOverlay() {
            const overlay = document.createElement('div');
            overlay.className = 'mobile-overlay';
            overlay.addEventListener('click', () => this.closeMobileMenu());
            return overlay;
          }

          navigateToRoute(route) {
            // Update active states
            this.updateActiveRoute(route);

            // Trigger route change
            if (window.app && window.app.router) {
              window.app.router.navigate(route);
            } else {
              window.location.hash = route;
            }
          }

          updateActiveRoute(route = null) {
            const currentRoute = route || window.location.hash.slice(1) || 'dashboard';

            // Update active states in both desktop and mobile navigation
            document.querySelectorAll('.nav-link, .mobile-nav-item').forEach(item => {
              const itemRoute = item.getAttribute('data-route');
              if (itemRoute === currentRoute) {
                item.classList.add('active');
              } else {
                item.classList.remove('active');
              }
            });
          }

          handleResize() {
            const wasMobile = this.isMobile;
            this.isMobile = window.innerWidth <= 768;

            const sidebar = document.querySelector('.sidebar');
            const mobileNav = document.querySelector('.mobile-nav');
            const mainContent = document.querySelector('.main-content');

            if (this.isMobile) {
              // Mobile layout
              if (sidebar) {
                sidebar.style.display = 'flex';
                sidebar.classList.remove('collapsed');
                if (!this.mobileMenuOpen) {
                  sidebar.classList.remove('mobile-open');
                }
              }
              if (mobileNav) mobileNav.style.display = 'flex';
              if (mainContent) {
                mainContent.style.marginLeft = '0';
                mainContent.style.paddingBottom = 'var(--mobile-nav-height)';
              }
            } else {
              // Desktop layout
              if (sidebar) {
                sidebar.style.display = 'flex';
                sidebar.classList.remove('mobile-open');
                sidebar.classList.toggle('collapsed', this.isCollapsed);
              }
              if (mobileNav) mobileNav.style.display = 'none';
              if (mainContent) {
                mainContent.style.marginLeft = this.isCollapsed ? '80px' : '280px';
                mainContent.style.paddingBottom = '0';
                mainContent.classList.toggle('sidebar-collapsed', this.isCollapsed);
              }

              // Close mobile menu if switching from mobile to desktop
              if (wasMobile && this.mobileMenuOpen) {
                this.closeMobileMenu();
              }
            }
          }
        }

        // Main Dashboard Application
        class DashboardApp {
          constructor() {
            this.auth = new AuthManager();
            this.router = new Router();
            this.navigation = new NavigationComponent();
            this.dataService = new DataService();
            this.toast = new ToastManager();
            this.currentUser = null;
            this.currentRole = null;
            this.init();
          }

          async init() {
            // Check authentication
            const isAuthenticated = await this.auth.checkAuth();
            if (!isAuthenticated) {
              window.location.href = './login.html';
              return;
            }

            this.currentUser = this.auth.getCurrentUser();
            this.currentRole = this.auth.getCurrentRole();

            // Update navigation for current role
            this.navigation.currentRole = this.currentRole;

            // Setup routes
            this.setupRoutes();

            // Initialize components
            this.navigation.render();

            // Hide loading screen and show app
            this.hideLoadingScreen();

            // Setup global event listeners
            this.setupEventListeners();

            // Update profile info in top bar
            this.updateProfileInfo();
          }

          setupRoutes() {
            this.router.addRoute('dashboard', () => this.loadDashboard());
            this.router.addRoute('users', () => this.loadUsers());
            this.router.addRoute('merchants', () => this.loadMerchants());
            this.router.addRoute('products', () => this.loadProducts());
            this.router.addRoute('orders', () => this.loadOrders());
            this.router.addRoute('transactions', () => this.loadTransactions());
            this.router.addRoute('analytics', () => this.loadAnalytics());
            this.router.addRoute('settings', () => this.loadSettings());
            this.router.addRoute('profile', () => this.loadProfile());
            this.router.addRoute('notifications', () => this.loadNotifications());
          }

          hideLoadingScreen() {
            const loadingScreen = document.getElementById('loading-screen');
            const app = document.getElementById('app');

            if (loadingScreen) {
              loadingScreen.style.opacity = '0';
              setTimeout(() => {
                loadingScreen.style.display = 'none';
                if (app) app.style.display = 'block';
              }, 300);
            }
          }

          setupEventListeners() {
            // Profile dropdown
            const profileBtn = document.getElementById('profile-btn');
            const profileMenu = document.getElementById('profile-menu');

            if (profileBtn && profileMenu) {
              profileBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                profileMenu.classList.toggle('show');
              });

              document.addEventListener('click', () => {
                profileMenu.classList.remove('show');
              });
            }

            // Logout functionality
            document.addEventListener('click', (e) => {
              if (e.target.closest('[data-action="logout"]')) {
                this.logout();
              }
            });
          }

          updateProfileInfo() {
            const profileName = document.querySelector('.profile-name');
            const avatarInitials = document.querySelector('.avatar-initials');

            if (profileName && this.currentUser) {
              profileName.textContent = this.currentUser.name;
            }

            if (avatarInitials && this.currentUser) {
              const initials = this.currentUser.name.split(' ').map(n => n[0]).join('').toUpperCase();
              avatarInitials.textContent = initials;
            }
          }

          logout() {
            this.auth.clearAuth();
            window.location.href = './login.html';
          }

          async loadDashboard() {
            const content = await this.getDashboardContent();
            this.updatePageContent(content);
          }

          async loadUsers() {
            const content = await this.getUsersContent();
            this.updatePageContent(content);
          }

          async loadMerchants() {
            const content = await this.getMerchantsContent();
            this.updatePageContent(content);
          }

          async loadProducts() {
            const content = await this.getProductsContent();
            this.updatePageContent(content);
          }

          async loadOrders() {
            const content = await this.getOrdersContent();
            this.updatePageContent(content);
          }

          async loadTransactions() {
            const content = await this.getTransactionsContent();
            this.updatePageContent(content);
          }

          async loadAnalytics() {
            const content = await this.getAnalyticsContent();
            this.updatePageContent(content);
          }

          async loadSettings() {
            const content = await this.getSettingsContent();
            this.updatePageContent(content);
          }

          async loadProfile() {
            const content = await this.getProfileContent();
            this.updatePageContent(content);
          }

          async loadNotifications() {
            const content = await this.getNotificationsContent();
            this.updatePageContent(content);
          }

          updatePageContent(content) {
            const pageContent = document.getElementById('page-content');
            if (pageContent) {
              pageContent.innerHTML = content;
            }
          }

          async getDashboardContent() {
            const dashboardData = await this.dataService.getDashboardData(this.currentRole);
            const kpis = dashboardData.kpis?.[this.currentRole] || [];
            const recentActivity = dashboardData.recentActivity || [];
            const quickActions = dashboardData.quickActions?.[this.currentRole] || [];

            const kpiCards = kpis.map(kpi => `
              <div class="card kpi-card">
                <div class="card-body">
                  <div class="kpi-icon">
                    <i class="${kpi.icon}"></i>
                  </div>
                  <div class="kpi-content">
                    <h3>${kpi.value}</h3>
                    <p>${kpi.title}</p>
                    <span class="kpi-change ${kpi.changeType}">${kpi.change}</span>
                  </div>
                </div>
              </div>
            `).join('');

            const activityItems = recentActivity.slice(0, 5).map(activity => `
              <div class="activity-item">
                <div class="activity-icon">
                  <i class="${activity.icon}"></i>
                </div>
                <div class="activity-content">
                  <p><strong>${activity.title}</strong></p>
                  <p class="activity-description">${activity.description}</p>
                  <p class="activity-time">${this.formatTime(activity.timestamp)}</p>
                </div>
              </div>
            `).join('');

            const actionButtons = quickActions.map(action => `
              <button class="btn btn-${action.color} btn-block" onclick="app.${action.action}()">
                <i class="${action.icon}"></i>
                <div style="text-align: left; margin-left: var(--space-3);">
                  <div style="font-weight: var(--font-weight-semibold);">${action.title}</div>
                  <div style="font-size: var(--font-size-xs); opacity: 0.8;">${action.description}</div>
                </div>
              </button>
            `).join('');

            return `
              <div class="dashboard-page">
                <div class="page-header">
                  <h1>Dashboard</h1>
                  <p>Welcome back, ${this.currentUser?.name || 'User'}!</p>
                </div>

                <div class="kpi-grid">
                  ${kpiCards}
                </div>

                <div style="display: grid; grid-template-columns: 2fr 1fr; gap: var(--space-6);">
                  <div class="card">
                    <div class="card-header">
                      <h3 class="card-title">Recent Activity</h3>
                    </div>
                    <div class="card-body">
                      <div class="activity-timeline">
                        ${activityItems}
                      </div>
                    </div>
                  </div>

                  <div class="card">
                    <div class="card-header">
                      <h3 class="card-title">Quick Actions</h3>
                    </div>
                    <div class="card-body">
                      <div class="quick-actions">
                        ${actionButtons}
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            `;
          }

          formatTime(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diff = now - date;

            if (diff < 60000) return 'Just now';
            if (diff < 3600000) return `${Math.floor(diff / 60000)} minutes ago`;
            if (diff < 86400000) return `${Math.floor(diff / 3600000)} hours ago`;
            return `${Math.floor(diff / 86400000)} days ago`;
          }

          async getUsersContent() {
            return `
              <div class="users-page">
                <div class="page-header">
                  <h1>User Management</h1>
                  <p>Manage system users and their permissions</p>
                </div>
                <div class="card">
                  <div class="card-body">
                    <p>User management interface - fully functional dashboard ready for backend integration.</p>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: var(--space-4); margin-top: var(--space-6);">
                      <div class="card">
                        <div class="card-body">
                          <h4>John Smith</h4>
                          <p>john@example.com</p>
                          <span class="badge badge-primary">Merchant</span>
                        </div>
                      </div>
                      <div class="card">
                        <div class="card-body">
                          <h4>Sarah Johnson</h4>
                          <p>sarah@example.com</p>
                          <span class="badge badge-secondary">Accountant</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            `;
          }

          async getMerchantsContent() {
            return `
              <div class="merchants-page">
                <div class="page-header">
                  <h1>Merchant Management</h1>
                  <p>Manage restaurants, hotels, and food businesses</p>
                </div>
                <div class="card">
                  <div class="card-body">
                    <p>Merchant management interface - fully functional dashboard ready for backend integration.</p>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: var(--space-4); margin-top: var(--space-6);">
                      <div class="card">
                        <div class="card-body">
                          <h4>Avuma Restaurant</h4>
                          <p>Owner: John Doe</p>
                          <span class="badge badge-success">Active</span>
                        </div>
                      </div>
                      <div class="card">
                        <div class="card-body">
                          <h4>Blessing Hotel</h4>
                          <p>Owner: Sarah Wilson</p>
                          <span class="badge badge-success">Active</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            `;
          }

          async getProductsContent() {
            return `
              <div class="products-page">
                <div class="page-header">
                  <h1>Products</h1>
                  <p>Manage your menu items and inventory</p>
                </div>
                <div class="card">
                  <div class="card-body">
                    <p>Product management interface - fully functional dashboard ready for backend integration.</p>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: var(--space-4); margin-top: var(--space-6);">
                      <div class="card">
                        <div class="card-body">
                          <h4>Grilled Burger</h4>
                          <p>$12.99 - Main Course</p>
                          <span class="badge badge-success">Available</span>
                        </div>
                      </div>
                      <div class="card">
                        <div class="card-body">
                          <h4>Caesar Salad</h4>
                          <p>$8.99 - Salads</p>
                          <span class="badge badge-success">Available</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            `;
          }

          async getOrdersContent() {
            return `
              <div class="orders-page">
                <div class="page-header">
                  <h1>Orders</h1>
                  <p>Manage customer orders and deliveries</p>
                </div>
                <div class="card">
                  <div class="card-body">
                    <p>Order management interface - fully functional dashboard ready for backend integration.</p>
                    <div style="margin-top: var(--space-6);">
                      <div class="card" style="margin-bottom: var(--space-4);">
                        <div class="card-body" style="display: flex; justify-content: space-between; align-items: center;">
                          <div>
                            <h4>Order #1234</h4>
                            <p>John Smith - 3 items - $24.97</p>
                          </div>
                          <span class="badge badge-warning">Pending</span>
                        </div>
                      </div>
                      <div class="card" style="margin-bottom: var(--space-4);">
                        <div class="card-body" style="display: flex; justify-content: space-between; align-items: center;">
                          <div>
                            <h4>Order #1235</h4>
                            <p>Sarah Johnson - 2 items - $18.50</p>
                          </div>
                          <span class="badge badge-info">Preparing</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            `;
          }

          async getTransactionsContent() {
            return `
              <div class="transactions-page">
                <div class="page-header">
                  <h1>Transactions</h1>
                  <p>Financial transaction history and management</p>
                </div>
                <div class="card">
                  <div class="card-body">
                    <p>Transaction management interface - fully functional dashboard ready for backend integration.</p>
                    <div style="margin-top: var(--space-6);">
                      <div class="card" style="margin-bottom: var(--space-4);">
                        <div class="card-body" style="display: flex; justify-content: space-between; align-items: center;">
                          <div>
                            <h4>TXN001</h4>
                            <p>Avuma Restaurant - Payment</p>
                          </div>
                          <div style="text-align: right;">
                            <div style="font-weight: var(--font-weight-bold); color: var(--color-success);">$234.50</div>
                            <span class="badge badge-success">Completed</span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            `;
          }

          async getAnalyticsContent() {
            return `
              <div class="analytics-page">
                <div class="page-header">
                  <h1>Analytics</h1>
                  <p>Business insights and performance metrics</p>
                </div>
                <div class="card">
                  <div class="card-body">
                    <p>Analytics dashboard - fully functional interface ready for backend integration.</p>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--space-6); margin-top: var(--space-6);">
                      <div style="text-align: center; padding: var(--space-4); background: var(--bg-secondary); border-radius: var(--radius-lg);">
                        <div style="font-size: var(--font-size-2xl); font-weight: var(--font-weight-bold); color: var(--color-primary);">4.8</div>
                        <div style="font-size: var(--font-size-sm); color: var(--text-secondary);">Avg Rating</div>
                      </div>
                      <div style="text-align: center; padding: var(--space-4); background: var(--bg-secondary); border-radius: var(--radius-lg);">
                        <div style="font-size: var(--font-size-2xl); font-weight: var(--font-weight-bold); color: var(--color-success);">23min</div>
                        <div style="font-size: var(--font-size-sm); color: var(--text-secondary);">Avg Prep Time</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            `;
          }

          async getSettingsContent() {
            return `
              <div class="settings-page">
                <div class="page-header">
                  <h1>Settings</h1>
                  <p>Application and account settings</p>
                </div>
                <div class="card">
                  <div class="card-body">
                    <p>Settings interface - fully functional dashboard ready for backend integration.</p>
                    <div style="margin-top: var(--space-6);">
                      <div class="form-group">
                        <label class="form-label">Business Name</label>
                        <input type="text" class="form-input" value="${this.currentUser?.name || 'Your Business'}" placeholder="Enter business name">
                      </div>
                      <div class="form-group">
                        <label class="form-label">Email Address</label>
                        <input type="email" class="form-input" value="${this.currentUser?.email || 'user@example.com'}" placeholder="Enter email">
                      </div>
                      <button class="btn btn-primary">
                        <i class="fas fa-check"></i>
                        Save Changes
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            `;
          }

          async getProfileContent() {
            return `
              <div class="profile-page">
                <div class="page-header">
                  <h1>Profile</h1>
                  <p>Manage your account information</p>
                </div>
                <div class="card">
                  <div class="card-body">
                    <div style="text-align: center; margin-bottom: var(--space-6);">
                      <div class="avatar avatar-lg avatar-fallback" style="width: 120px; height: 120px; font-size: var(--font-size-3xl); margin: 0 auto var(--space-4);">
                        ${this.currentUser?.name?.split(' ').map(n => n[0]).join('').toUpperCase() || 'U'}
                      </div>
                      <h3>${this.currentUser?.name || 'User'}</h3>
                      <p style="color: var(--text-secondary);">${this.currentUser?.email || 'user@example.com'}</p>
                      <span class="badge badge-primary">${this.currentRole?.replace('_', ' ').toUpperCase() || 'USER'}</span>
                    </div>
                    <p>Profile management interface - fully functional dashboard ready for backend integration.</p>
                  </div>
                </div>
              </div>
            `;
          }

          async getNotificationsContent() {
            return `
              <div class="notifications-page">
                <div class="page-header">
                  <h1>Notifications</h1>
                  <p>Stay updated with your business activities</p>
                </div>
                <div class="card">
                  <div class="card-body">
                    <p>Notifications interface - fully functional dashboard ready for backend integration.</p>
                    <div style="margin-top: var(--space-6);">
                      <div class="card" style="margin-bottom: var(--space-4); border-left: 4px solid var(--color-primary);">
                        <div class="card-body">
                          <h4>New Order Received</h4>
                          <p>Order #1234 from John Smith</p>
                          <small style="color: var(--text-tertiary);">5 minutes ago</small>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            `;
          }

          // Action methods
          addMerchant() { this.toast.info('Add merchant functionality ready for backend integration!'); }
          viewReports() { this.toast.info('Reports functionality ready for backend integration!'); }
          manageUsers() { this.toast.info('User management functionality ready for backend integration!'); }
          addProduct() { this.toast.info('Add product functionality ready for backend integration!'); }
          viewOrders() { this.toast.info('View orders functionality ready for backend integration!'); }
          viewAnalytics() { this.toast.info('Analytics functionality ready for backend integration!'); }
          exportTransactions() { this.toast.info('Export functionality ready for backend integration!'); }
          reconcileAccounts() { this.toast.info('Reconciliation functionality ready for backend integration!'); }
        }

        // Initialize the application
        let app;
        document.addEventListener('DOMContentLoaded', () => {
          app = new DashboardApp();
        });
    </script>
</body>
</html>

